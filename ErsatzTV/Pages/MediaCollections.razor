@page "/media/collections"
@using ErsatzTV.Application.MediaCollections
@using ErsatzTV.Application.MediaCollections.Commands
@using ErsatzTV.Application.MediaCollections.Queries
@inject IDialogService Dialog
@inject IMediator Mediator

@* @if (context.IsSimple) *@
@* { *@
@*     <MudMenu Icon="@Icons.Material.Filled.MoreVert"> *@
@*         <MudMenuItem Icon="@Icons.Material.Filled.Edit" Link="@($"/media/collections/{context.Id}")"> *@
@*             Edit Properties *@
@*         </MudMenuItem> *@
@*         <MudMenuItem Icon="@Icons.Material.Filled.Edit" Link="@($"/media/collections/{context.Id}/items")"> *@
@*             Edit Media Items *@
@*         </MudMenuItem> *@
@*         <MudMenuItem Icon="@Icons.Material.Filled.Delete" OnClick="@(_ => DeleteMediaCollectionAsync(context))"> *@
@*             Delete *@
@*         </MudMenuItem> *@
@*     </MudMenu> *@
@* } *@

<MudContainer MaxWidth="MaxWidth.False" Class="media-card-grid">
    @foreach (MediaCollectionViewModel card in _data)
    {
        <MediaCard Data="@card"
                   Link="@($"/media/collections/{card.Id}")"
                   ContainerClass="media-card-episode-container mr-4"
                   CardClass="media-card-episode"/>
    }
</MudContainer>

<MudContainer MaxWidth="MaxWidth.False">
    <MudButton Variant="Variant.Filled" Color="Color.Primary" Link="/media/collections/add" Class="mt-4">
        Add Media Collection
    </MudButton>
</MudContainer>

@code {
    private List<MediaCollectionViewModel> _data;

    protected override Task OnParametersSetAsync() => RefreshData();

    private async Task RefreshData() =>
        _data = await Mediator.Send(new GetAllMediaCollections());

    private async Task DeleteMediaCollectionAsync(MediaCollectionSummaryViewModel mediaCollection)
    {
        if (mediaCollection.IsSimple)
        {
            var parameters = new DialogParameters { { "EntityType", "media collection" }, { "EntityName", mediaCollection.Name } };
            var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.ExtraSmall };

            IDialogReference dialog = Dialog.Show<DeleteDialog>("Delete Media Collection", parameters, options);
            DialogResult result = await dialog.Result;
            if (!result.Cancelled)
            {
                await Mediator.Send(new DeleteSimpleMediaCollection(mediaCollection.Id));
                await RefreshData();
            }
        }
    }

}